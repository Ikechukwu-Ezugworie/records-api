name: Pull Request Notification to Telegram

on:
  pull_request:
    types: [opened, edited, closed]  # Trigger on PR open, edit, or close

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send PR notification to Telegram
        run: |
          # Determine PR action and assign appropriate icon and label
          if [ "${{ github.event.action }}" == "opened" ]; then
            PR_STATUS="New Pull Request"
            ACTION_LABEL="Opened by"
            ACTION_USER="${{ github.event.pull_request.user.login }}"
            ACTION_DATE="${{ github.event.pull_request.created_at }}"
            ICON="üöÄ"  # New PR icon
          elif [ "${{ github.event.action }}" == "edited" ]; then
            PR_STATUS="Updated Pull Request"
            ACTION_LABEL="Edited by"
            ACTION_USER="${{ github.actor }}"
            ACTION_DATE="${{ github.event.pull_request.created_at }}"
            ICON="‚úèÔ∏è"  # Edited PR icon
          elif [ "${{ github.event.action }}" == "closed" ]; then
            PR_STATUS="Closed Pull Request"
            ACTION_LABEL="üö™ Closed by"
            ACTION_USER="${{ github.actor }}"
            ACTION_DATE="${{ github.event.pull_request.created_at }}"
            ICON="‚úÖ"  # Closed PR icon
          fi

          # Format the dates for readability (e.g., "Mon, Feb 24, 2025 at 10:00 AM")
          FORMATTED_CREATED_DATE=$(date -d "${{ github.event.pull_request.created_at }}" "+%a, %b %d, %Y at %I:%M %p")
          FORMATTED_ACTION_DATE=$(date -d "${ACTION_DATE}" "+%a, %b %d, %Y at %I:%M %p")

          # Send the message to Telegram
          curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_API/sendMessage" \
          -d chat_id=$TELEGRAM_CHANNEL_ID \
          -d parse_mode="Markdown" \
          -d text="$ICON *$PR_STATUS*%0Aüìå **Title:** ${{ github.event.pull_request.title }}%0Aüë§ **Created by:** ${{ github.event.pull_request.user.login }} | üóì $FORMATTED_CREATED_DATE%0A$ACTION_LABEL: $ACTION_USER | üóì $FORMATTED_ACTION_DATE%0Aüîó [View PR](${{ github.event.pull_request.html_url }})"
